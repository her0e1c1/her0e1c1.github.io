
========================================
 Using Fabric Automate Your Local Tasks
========================================

Fabric is a tool for deployment. But I think it's not only for that.
I mean I think fabric is **a small wrapper of shell script**.

If you are not used to writing shell scripts but bored of typing same commands repeatedly.
I recommend you should use fabric and automate them.

.. contents::

Let's try
=========

Fisrt install fabric. ::

   easy_install fabric

Create a directory and files below. ::

   ~/.fabricrc
   ~/fabfile/
   ~/fabfile/__init__.py

Modify them below so that you can print `Hello World!`.

`~/fabfile/__init__.py` ::

   from fabric.api import *

   @task
   def hello():
       print(env.msg)

`~/.farricrc` ::

   # This is a setting file. if you write ``ATTR = VAL``, then you can refer the VAL with `env.ATTR`.
   msg = Hello World!

You are ready to print `Hello World!`. So type the command.

.. code-block:: sh

    $ fab hello

Output is like this. ::

    [localhost] Executing task 'hello'
    Hello World!

    Done.

Example for building shinx documents at a time
==============================================
Someone use the command like this to build rst files. ::

    cd /path/to/sphinx_doc
    make html

I think this is too many typing.
If you have more sphinx documents, do you want to do `cd command` everytime you build a shinx document?

So to build all sphinx documents at a time, write codes with fabric like this.

`~/fabfile/__init__.py` ::

    from fabric.api import *
    from . import update

    env.sphinx_dir = [
        ("~/sphinx/article", "~/sphinx_build/article"),
        ("~/shpinx/dairy", "~/sphinx_build/dairy")
    ]

`~/fabfile/update.py` ::

    from fabric.api import *

    @task
    def sphinx():
        # if env doesn't have the sphinx_dir attribute, error occurs.
        require("sphinx_dir")
        for src, dst in env.sphinx_dir:
            local("sphinx-build -b html %s %s" % (src, dst))  

Once you made these files, you can build sphinx documents at one command. ::

    fab update.sphinx
