
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>design-pattern &mdash; Hiroyuki Ishii</title>
    
    <link rel="stylesheet" href="../../../static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/bootswatch-3.3.4/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Hiroyuki Ishii" href="../../../index.html" />
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-67799795-2', 'auto');
    ga('send', 'pageview');
  </script>


  </head>
  <body role="document">

<div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
  <div class="container">

    
    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../index.html">
        Hiroyuki Ishii</a>
      <span class="navbar-text navbar-version pull-left"><b></b></span>
    </div>

    
    <div class="collapse navbar-collapse nav-collapse">
      <ul class="nav navbar-nav">
        
            <li><a href="../../../products.html">Products</a></li>
            <li><a href="../../index.html">Snippets</a></li>
            <li><a href="../../../about_me.html">About Me</a></li>
        
      </ul>
      
        

      
    </div>

  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="design-pattern">
<h1><a class="toc-backref" href="#id1">design-pattern</a><a class="headerlink" href="#design-pattern" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#design-pattern" id="id1">design-pattern</a><ul>
<li><a class="reference internal" href="#composite-scm" id="id2">composite.scm</a></li>
<li><a class="reference internal" href="#index-scm" id="id3">index.scm</a></li>
<li><a class="reference internal" href="#iterator-scm" id="id4">iterator.scm</a></li>
<li><a class="reference internal" href="#state-scm" id="id5">state.scm</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="composite-scm">
<h2><a class="toc-backref" href="#id2">composite.scm</a><a class="headerlink" href="#composite-scm" title="Permalink to this headline">¶</a></h2>
<p>Component * &#8211;&lt;&gt; 1 Composite
Component + operation() &lt;- Leaf
Component + operation() &lt;- Composite</p>
<p>Composite Patternでは、箱をその中身と同様に扱う。
今回はファイルシステムを例にするため,
箱がDirectoryで、中身がFileとする。(Directoryは箱と中身の両方の役割を担う)</p>
<p>このパターンが有効なのは、再帰構造をしたデータである。
TreeのNodeがDirectoryで、LeafがFileとなる。</p>
<p>このパターンで必要となるものは
親子共通メソッドとCompositeにインスタンスを格納する容器</p>
<p>木構造の例
ツリーの関係(Node/Leaf)
DOM(html)
Parent/Children</p>
<dl class="docutils">
<dt>以下のようなクラス</dt>
<dd><dl class="first last docutils">
<dt>class Node:</dt>
<dd>children = []</dd>
</dl>
</dd>
</dl>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">interface</span> <span class="nc">EntryInterface</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Directory</span> <span class="kd">implements</span> <span class="n">EntryInterface</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 <span class="n">Directory</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
 <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">EntryInterface</span><span class="o">&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">EntryInterface</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="n">entries</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span> <span class="o">}</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">EntryInterface</span> <span class="n">e</span><span class="o">:</span> <span class="n">entries</span><span class="o">)</span> <span class="o">{</span> <span class="n">e</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span> <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Remove a %s directory\n&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">File</span> <span class="kd">implements</span> <span class="n">EntryInterface</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 <span class="n">File</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Remove a %s file\n&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Directory</span> <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Directory</span><span class="o">(</span><span class="s">&quot;root&quot;</span><span class="o">);</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">:</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">))</span>
   <span class="n">root</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;text%d.txt&quot;</span><span class="o">,</span> <span class="n">i</span><span class="o">)));</span>

  <span class="n">Directory</span> <span class="n">sub</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Directory</span><span class="o">(</span><span class="s">&quot;sub dir&quot;</span><span class="o">);</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">:</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">))</span>
   <span class="n">sub</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;music%d.mp3&quot;</span><span class="o">,</span> <span class="n">i</span><span class="o">)));</span>
  <span class="n">root</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">sub</span><span class="o">);</span>

  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Call a remove method of a root directory...&quot;</span><span class="o">);</span>
  <span class="n">root</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>Call a remove method of a root directory...
Remove a text1.txt file
Remove a text2.txt file
Remove a text3.txt file
Remove a text4.txt file
Remove a text5.txt file
Remove a music1.mp3 file
Remove a music2.mp3 file
Remove a music3.mp3 file
Remove a music4.mp3 file
Remove a music5.mp3 file
Remove a sub dir directory
Remove a root directory
</pre></div>
</div>
</div>
<div class="section" id="index-scm">
<h2><a class="toc-backref" href="#id3">index.scm</a><a class="headerlink" href="#index-scm" title="Permalink to this headline">¶</a></h2>
<p>区分方法(生成・振る舞い・構造/Encapsulation, polymorphism, inheritance)
- 継承(クラスの関係)
- 委譲と多重度(クラスの関係)
- キャッシュ
- ポリモーフィズム（共通メソッド==同一視）</p>
<blockquote>
<div><ul class="simple">
<li>振る舞い</li>
<li>データ生成</li>
<li>クラスの条件分岐(全て、１つ)</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>インターフェイス(使い手側がどう見えるか)
- 既存コード修正必要・修正不要
- wrapper(同一視+機能追加、インターフェイス改善-引数)
- 状態(mutable/imutable)
- 条件分岐(client側で分岐?implementer側で分岐?)</li>
</ul>
<p>親と子供達（委譲）に共通のメソッドを用意
- composite(親子同一視)</p>
<p>親達(委譲)に共通のメソッドを用意
- state(親の差し替え前提)
- strategy(behavior、インスタンス時のみに選択できるが、差し替えしない)
- bridge(structure、選択させない、差し替えしない)</p>
<p>直系先祖達(委譲)に対して共通のメソッドを用意
- decorator(親子同一視)
- Chain of Responsibility(条件分岐==クラスの選択)</p>
<p>子供達に対して共通のメソッドを用意
- observer(subjectの状態変更通知, 1:N?)
- command(interfaceと実装の分離。実装１つ、インターフェイス複数、N:Mの関係)</p>
<p>Treeに対する評価
- visitor(動的にメソッド切り替える)</p>
<p>Listに対する評価
- iterator</p>
<p>別クラスのメソッドを呼び出す(一人委譲の親の委譲あり、逆参照なし)
- adaptor(一つのクラスをラップして、使いやすいインターフェイスを提供)
- proxy(別クラスと同一視、別クラスとプロキシクラスに同じメソッドが必要)
- facade(複数のクラスをラップして、使いやすいインターフェイスを提供)</p>
<p>N:Nの関係をN:1にする
- mediator(多重度の修正)</p>
<p>継承した子供の共通メソッド(データ生成)
- factory method(単一クラス)
- abstract factory(複数クラス)</p>
<p>関数型としての比較
- strategy (関数オブジェクト)
- visitor (foldable)
- composit (recursive data)</p>
</div>
<div class="section" id="iterator-scm">
<h2><a class="toc-backref" href="#id4">iterator.scm</a><a class="headerlink" href="#iterator-scm" title="Permalink to this headline">¶</a></h2>
<p># Aggregate +iterator() &lt;- ConcreteAggregate
# Iterator +next(), hasNext() &lt;- ConcreteIterator
# Aggregate &#8211; create &#8211;&gt; ConcreteAggregate
# ConcreteAggregate &#8211;&lt;&gt; ConcreteIterator
# オブジェクトを繰り返して取得する場合の実装方法</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Pack</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pack</span><span class="o">();</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Candy</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Candy</span><span class="o">(</span><span class="mi">200</span><span class="o">));</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Candy</span><span class="o">(</span><span class="mi">300</span><span class="o">));</span>
  <span class="n">Iter</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">iter</span><span class="o">();</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
   <span class="n">Candy</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Candy</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
 <span class="n">Candy</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span> <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;candy(%d)&quot;</span><span class="o">,</span> <span class="n">price</span><span class="o">);</span> <span class="o">};</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Pack</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Candy</span><span class="o">&gt;</span> <span class="n">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Candy</span><span class="o">&gt;();</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Candy</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span> <span class="n">pack</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">c</span><span class="o">);}</span>
 <span class="kd">public</span> <span class="n">Iter</span> <span class="nf">iter</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">Iter</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pack</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Iter</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Candy</span><span class="o">&gt;</span> <span class="n">pack</span><span class="o">;</span>
 <span class="n">Iter</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Candy</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">pack</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span> <span class="o">}</span>
 <span class="n">Candy</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">pack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span> <span class="o">}</span>
 <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">pack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>candy<span class="o">(</span>100<span class="o">)</span>
candy<span class="o">(</span>200<span class="o">)</span>
candy<span class="o">(</span>300<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="state-scm">
<h2><a class="toc-backref" href="#id5">state.scm</a><a class="headerlink" href="#state-scm" title="Permalink to this headline">¶</a></h2>
<p>stateパターンは状態によって、呼び出すメソッドを変更させる</p>
<p>context &lt;&gt;&#8211; state
context +method1
state +method1 &lt;- state1
state +method1 &lt;- state2</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">interface</span> <span class="nc">State</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Fine</span> <span class="kd">implements</span> <span class="n">State</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello I&#39;m file :D&quot;</span><span class="o">);</span> <span class="o">};</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Angry</span> <span class="kd">implements</span> <span class="n">State</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;):&quot;</span><span class="o">);</span> <span class="o">};</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Human</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span><span class="o">;</span>
 <span class="n">Human</span><span class="o">(</span><span class="n">State</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="n">state</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span> <span class="o">}</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span> <span class="n">state</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span> <span class="o">};</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">(</span><span class="k">new</span> <span class="n">Human</span><span class="o">(</span><span class="k">new</span> <span class="n">Fine</span><span class="o">())).</span><span class="na">hello</span><span class="o">();</span>
  <span class="o">(</span><span class="k">new</span> <span class="n">Human</span><span class="o">(</span><span class="k">new</span> <span class="n">Angry</span><span class="o">())).</span><span class="na">hello</span><span class="o">();</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre>Hello I&#39;m file :D
):
</pre></div>
</div>
<div class="section" id="normal-fast-slow">
<h3>クラスの状態(Normal, Fast, Slow)に合わせてプレイヤーの移動速度が変わる<a class="headerlink" href="#normal-fast-slow" title="Permalink to this headline">¶</a></h3>
<div class="highlight-py"><div class="highlight"><pre><span class="c"># URL: http://nekogata.hatenablog.com/entry/2013/02/09/233540</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Normal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Fast</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Slow</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Player</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Player</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">left</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">Fast</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">down</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">right</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">Slow</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">left</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">(</span>1, 0<span class="o">)</span>
<span class="o">(</span>1, 1<span class="o">)</span>
<span class="o">(</span>-1, 1<span class="o">)</span>
<span class="o">(</span>-1, -1<span class="o">)</span>
<span class="o">(</span>-0.5, -1.0<span class="o">)</span>
<span class="o">(</span>-0.5, -0.5<span class="o">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">

  
  

  <div class="container">
    
    <p>
        &copy; Copyright 2015, Hiroyuki Ishii.<br/>
    </p>
  </div>
</footer>

  </body>
</html>